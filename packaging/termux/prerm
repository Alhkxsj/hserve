#!/bin/bash
set -e

echo "ğŸ”„ æ£€æµ‹åˆ° hserve æ—§ç‰ˆæœ¬ï¼Œæ­£åœ¨å‡†å¤‡æ›´æ–°..."

# åˆ é™¤æ—§çš„è¯ä¹¦ç›®å½•
if [ -d "$PREFIX/etc/hserve" ]; then
    echo "ğŸ—‘ï¸  æ£€æµ‹åˆ°æ—§è¯ä¹¦ç›®å½•ï¼Œæ­£åœ¨åˆ é™¤ï¼š$PREFIX/etc/hserve"
    rm -rf "$PREFIX/etc/hserve"
fi

# åˆ é™¤å¯èƒ½å­˜åœ¨çš„æ—§CAè¯ä¹¦
HOME_DIR=$(eval echo ~$(logname) 2>/dev/null || echo $HOME)
if [ -f "$HOME_DIR/hserve-ca.crt" ]; then
    echo "ğŸ—‘ï¸  æ£€æµ‹åˆ°æ—§CAè¯ä¹¦ï¼Œæ­£åœ¨åˆ é™¤ï¼š$HOME_DIR/hserve-ca.crt"
    rm -f "$HOME_DIR/hserve-ca.crt"
fi

# æ¸…ç†å¯èƒ½å­˜åœ¨çš„ä¸´æ—¶è¯ä¹¦æ–‡ä»¶
if [ -f "$HOME/hserve-ca.crt" ]; then
    echo "ğŸ—‘ï¸  æ£€æµ‹åˆ°æ—§CAè¯ä¹¦ï¼Œæ­£åœ¨åˆ é™¤ï¼š$HOME/hserve-ca.crt"
    rm -f "$HOME/hserve-ca.crt"
fi

echo "âœ… æ—§ç‰ˆæœ¬è¯ä¹¦æ¸…ç†å®Œæˆï¼Œå‡†å¤‡å®‰è£…æ–°ç‰ˆæœ¬"